# Exercises for week 5

## Exercise 1 - Bellman equation

### 1.a - Help from oliver or TA for PI version????

Default Bellman equation:

$$
U(s)=\max_{a \in A(s)} \sum_{s'}P(s'|s,a)[R(s,a,s')+\gamma U(s')]
$$

Pi Policy:

$$
\pi(s')= E[\sum_{t=0}^{\infty}\gamma^tR(S_t,\pi(S_t),S_{t+1}]
$$

Bellman equation using pi policy:

<!-- $$
U^\pi(s)=\max_{\pi(s') \in A(s)} \sum_{s'}P(s'|s,\pi(s'))[R(s,\pi(s'),s')+\gamma U(s')]
$$ -->

$$

U^\pi(s)= R(s) +  \sum_{s'}P(s'|s,\pi(s)) + \gamma U^\pi(s')
$$
<!-- $$
U^\pi(s)= R(s) + \sum_{s'}P(s'|s,\pi(s'))[R(s,\pi(s'),s')+\gamma U(s')]
$$ -->

$U(s)$ represents the expected utility of a state $(s)$, which means that it gives the maximum utility from a set of actions from a given state, without following a policy.\
$U^\pi(s)$ represents the expected utility of being in a given state $(s)$ following a given policy $\pi$, which might not return the maximum utility.

### 1.b

The Bellman equation would not hold if the Markov property was not satisfied.
This is due to Bellman not taking into account what has happened in the past and is only basing its utility on its current state.

### 1.c

Q-function returns the maximum utility of a given state and action pair.
Then the Bellman equation can use all the Q-values to evaluate the overall maximum utility of the given state.

### 1.d

$$
\max_{a \in A(s)} \sum_{s'}P(s'|s,a)[R(s,a)+\gamma U(s')]
$$

Step 1:

$$
\max_{a \in A(s)} \sum_{s'}P(s'|s,a) * R(s,a)+ P(s'|s,a) * \gamma U(s')
$$

Step 2:

$$
\max_{a \in A(s)} (\sum_{s'}P(s'|s,a) * R(s,a)+ \sum_{s'}P(s'|s,a) * \gamma U(s'))
$$

Step 3 (Used the rule of moving a constant out of the sum):
$$
\max_{a \in A(s)} ((R(s,a) \sum_{s'}P(s'|s,a)) + \sum_{s'}P(s'|s,a) * \gamma U(s'))
$$

Step 4 (The sum of all of the values from the transition function P will give 1. $\sum_{s'}P(s'|s,a) = 1$):

$$
\max_{a \in A(s)} ((R(s,a) * 1) + \sum_{s'}P(s'|s,a) * \gamma U(s'))
$$

Step 5:
$$
\max_{a \in A(s)} (R(s,a) + \sum_{s'}P(s'|s,a) * \gamma U(s'))
$$

Step 6:

$$
\max_{a \in A(s)} (R(s,a) + \gamma \sum_{s'}P(s'|s,a) * U(s'))
$$

Both have now been proven to be equal.

$$
\max_{a \in A(s)} R(s,a)+\gamma \sum_{s'}P(s'|s,a)U(s')
$$

## Exercise 2 - Grid World

### 2.a

$$
\max_{a \in A(s)} \sum_{s'}P(s'|s,a)[R(s,a)+\gamma U(s')]
$$

#### 1.1

$$
U(1,1) = max {
    [0.8(-0.05+1*U(1,2))+0.1(-0.05+1*U(2,1))+0.1(-0.05+1*U(1,1))],
    [0.9(-0.05+1*U(1,1))+0.1(-0.05+1*U(1,2))],
    [0.9(-0.05+1*U(1,1))+0.1(-0.05+1*U(2,1))],
    [0.8(-0.05+1*U(2,1))+0.1(-0.05+1*U(1,2))+0.1(-0.05+1*U(1,1))]
    }
$$

#### 1.2

$$
U(1,2) = max {
   [0.8(-0.05+1*U(1,3))+0.2(-0.05+1*U(1,2))],
   [0.8(-0.05+1*U(1,2))+0.1(-0.05+1*U(1,3))+0.1(-0.05+1*U(1,1))],
   [0.8(-0.05+1*U(1,1))+0.2(-0.05+1*U(1,2))],
   [0.8(-0.05+1*U(1,2))+0.1(-0.05+1*U(1,3))+0.1(-0.05+1*U(1,1))]
}
$$

#### 1.3

$$
U(1,3) = max {
    [0.9(-0.05+1*U(1,3))+0.1(-0.05+1*U(2,3))],
    [0.9(-0.05+1*U(1,3))+0.1(-0.05+1*U(1,2))],
    [0.8(-0.05+1*U(1,2))+0.1(-0.05+1*U(2,3))+0.1(-0.05+1*U(1,3))],
    [0.8(-0.05+1*U(2,3))+0.1(-0.05+1*U(1,2))+0.1(-0.05+1*U(1,3))]
}
$$

#### 2.1

$$
U(2,1) = max {
    [0.8(-0.05+1*U(1.1))+0.1(-0.05+1*U(1,1))+0.1(-0.05+1*U(3.1))],
    [0.8(-0.05+1*U(1,1))+0.2(-0.05+1*U(2,1))],
    [0.8(-0.05+1*U(2,1))+0.1(-0.05+1*U(1,1))+0.1(-0.05+1*U(3,1))],
    [0.8(-0.05+1*U(3,1))+0.2(-0.05+1*U(1,2))]
}
$$

#### 2.3

$$
U(2,3) = max {
    [0.8(-0.05+1*U(2,3))+0.1(-0.05+1*U(1,3))+0.1(-0.05+1*U(3,3))],
    [0.8(-0.05+1*U(1,3))+0.2(-0.05+1*U(2,3))],
    [0.8(-0.05+1*U(2,3))+0.1(-0.05+1*U(1,3))+0.1(-0.05+1*U(3,3))],
    [0.8(-0.05+1*U(3,3))+0.2(-0.05+1*U(2,3))]
}
$$

#### 3.1

$$
U(3,1) = max {
    [0.8(-0.05+1*U(3,2))+0.1(-0.05+1*U(4,1)+0.1(-0.05+1*U(2,1)))],
    [0.8(-0.05+1*U(2,1))+0.1(-0.05+1*U(3,1)+0.1(-0.05+1*U(3,2)))],
    [0.8(-0.05+1*U(3,1))+0.1(-0.05+1*U(2,1)+0.1(-0.05+1*U(4,1)))],
    [0.8(-0.05+1*U(4,1))+0.1(-0.05+1*U(3,2)+0.1(-0.05+1*U(3,1)))]
}
$$

#### 3.2

$$
U(3,2) = max {
    [0.8(-0.05+1*U(3,3))+0.1(-1)+0.1(-0.05+1*U(3,2))],
    [0.8(-0.05+1*U(3,2))+0.1(-0.05+1*U(3,1))+0.1(-0.05+1*U(3,3))],
    [0.8(-0.05+1*U(3,1))+0.1(-1)+0.1(-0.05+1*U(3.2))],
    [0.8(-1)+0.1(-0.05+1*U(3,1))0.1(-0.05+1*U(3,3))]
}
$$

#### 3.3

$$
U(3,3) = max {
    [0.8(-0.05+1*U(3,3)+0.1(-0.05+1*U(2,3))+0.1(+1))],
    [0.8(-0.05+1*U(2,3)+0.1(-0.05+1*U(3,3))+0.1(-0.05+1*U(3,2)))],
    [0.8(-0.05+1*U(3,2)+0.1(-0.05+1*U(2,3))+0.1(+1))],
    [0.8(+1)+0.1(-0.05+1*U(3,3))+0.1(-0.05+1*U(3,2))]
}
$$

#### 4.1

$$
U(4,1) = max {
    [0.8(-1)+0.1(-0.05+1*U(3,1))+0.1(-0.05+1*U(4,1))],
    [0.8(-0.05+1*U(3,1))+0.1(-1)+0.1(-0.05+1*U(4,1))],
    [0.9(-0.05+1*U(4,1))+0.1(-0.05+1*U(3,1))],
    [0.9(-0.05+1*U(4,1))+0.1(-1)]
}
$$

### 2.b

$$
\max_{a \in A(s)} \sum_{s'}P(s'|s,a)[R(s,a)+\gamma U(s')]
$$

#### 1.1

$$
U(1,1) = max {
    [0.8(-0.05+0.99*U(1,2))+0.1(-0.05+0.99*U(2,1))+0.1(-0.05+0.99*U(1,1))],
    [0.9(-0.05+0.99*U(1,1))+0.1(-0.05+0.99*U(1,2))],
    [0.9(-0.05+0.99*U(1,1))+0.1(-0.05+0.99*U(2,1))],
    [0.8(-0.05+0.99*U(2,1))+0.1(-0.05+0.99*U(1,2))+0.1(-0.05+0.99*U(1,1))]
    }
$$

#### 1.2

$$
U(1,2) = max {
   [0.8(-0.05+0.99*U(1,3))+0.2(-0.05+0.99*U(1,2))],
   [0.8(-0.05+0.99*U(1,2))+0.1(-0.05+0.99*U(1,3))+0.1(-0.05+0.99*U(1,1))],
   [0.8(-0.05+0.99*U(1,1))+0.2(-0.05+0.99*U(1,2))],
   [0.8(-0.05+0.99*U(1,2))+0.1(-0.05+0.99*U(1,3))+0.1(-0.05+0.99*U(1,1))]
}
$$

#### 1.3

$$
U(1,3) = max {
    [0.9(-0.05+0.99*U(1,3))+0.1(-0.05+0.99*U(2,3))],
    [0.9(-0.05+0.99*U(1,3))+0.1(-0.05+0.99*U(1,2))],
    [0.8(-0.05+0.99*U(1,2))+0.1(-0.05+0.99*U(2,3))+0.1(-0.05+0.99*U(1,3))],
    [0.8(-0.05+0.99*U(2,3))+0.1(-0.05+0.99*U(1,2))+0.1(-0.05+0.99*U(1,3))]
}
$$

#### 2.1

$$
U(2,1) = max {
    [0.8(-0.05+0.99*U(1.1))+0.1(-0.05+0.99*U(1,1))+0.1(-0.05+0.99*U(3.1))],
    [0.8(-0.05+0.99*U(1,1))+0.2(-0.05+0.99*U(2,1))],
    [0.8(-0.05+0.99*U(2,1))+0.1(-0.05+0.99*U(1,1))+0.1(-0.05+0.99*U(3,1))],
    [0.8(-0.05+0.99*U(3,1))+0.2(-0.05+0.99*U(1,2))]
}
$$

#### 2.3

$$
U(2,3) = max {
    [0.8(-0.05+0.99*U(2,3))+0.1(-0.05+0.99*U(1,3))+0.1(-0.05+0.99*U(3,3))],
    [0.8(-0.05+0.99*U(1,3))+0.2(-0.05+0.99*U(2,3))],
    [0.8(-0.05+0.99*U(2,3))+0.1(-0.05+0.99*U(1,3))+0.1(-0.05+0.99*U(3,3))],
    [0.8(-0.05+0.99*U(3,3))+0.2(-0.05+0.99*U(2,3))]
}
$$

#### 3.1

$$
U(3,1) = max {
    [0.8(-0.05+0.99*U(3,2))+0.1(-0.05+0.99*U(4,1)+0.1(-0.05+0.99*U(2,1)))],
    [0.8(-0.05+0.99*U(2,1))+0.1(-0.05+0.99*U(3,1)+0.1(-0.05+0.99*U(3,2)))],
    [0.8(-0.05+0.99*U(3,1))+0.1(-0.05+0.99*U(2,1)+0.1(-0.05+0.99*U(4,1)))],
    [0.8(-0.05+0.99*U(4,1))+0.1(-0.05+0.99*U(3,2)+0.1(-0.05+0.99*U(3,1)))]
}
$$

#### 3.2

$$
U(3,2) = max {
    [0.8(-0.05+0.99*U(3,3))+0.1(-1)+0.1(-0.05+0.99*U(3,2))],
    [0.8(-0.05+0.99*U(3,2))+0.1(-0.05+0.99*U(3,1))+0.1(-0.05+0.99*U(3,3))],
    [0.8(-0.05+0.99*U(3,1))+0.1(-1)+0.1(-0.05+0.99*U(3.2))],
    [0.8(-1)+0.1(-0.05+0.99*U(3,1))0.1(-0.05+0.99*U(3,3))]
}
$$

#### 3.3

$$
U(3,3) = max {
    [0.8(-0.05+0.99*U(3,3)+0.1(-0.05+0.99*U(2,3))+0.1(+1))],
    [0.8(-0.05+0.99*U(2,3)+0.1(-0.05+0.99*U(3,3))+0.1(-0.05+0.99*U(3,2)))],
    [0.8(-0.05+0.99*U(3,2)+0.1(-0.05+0.99*U(2,3))+0.1(+1))],
    [0.8(+1)+0.1(-0.05+0.99*U(3,3))+0.1(-0.05+0.99*U(3,2))]
}
$$

#### 4.1

$$
U(4,1) = max {
    [0.8(-1)+0.1(-0.05+0.99*U(3,1))+0.1(-0.05+0.99*U(4,1))],
    [0.8(-0.05+0.99*U(3,1))+0.1(-1)+0.1(-0.05+0.99*U(4,1))],
    [0.9(-0.05+0.99*U(4,1))+0.1(-0.05+0.99*U(3,1))],
    [0.9(-0.05+0.99*U(4,1))+0.1(-1)]
}
$$

### 2.c

### 2.d
